{"version":3,"names":[],"mappings":"","sources":["lcp-beacon.js"],"sourcesContent":["!function i(s,n,o){function c(t,e){if(!n[t]){if(!s[t]){var r=\"function\"==typeof require&&require;if(!e&&r)return r(t,!0);if(a)return a(t,!0);throw(r=new Error(\"Cannot find module '\"+t+\"'\")).code=\"MODULE_NOT_FOUND\",r}r=n[t]={exports:{}},s[t][0].call(r.exports,function(e){return c(s[t][1][e]||e)},r,r.exports,i,s,n,o)}return n[t].exports}for(var a=\"function\"==typeof require&&require,e=0;e<o.length;e++)c(o[e]);return c}({1:[function(e,t,r){\"use strict\";(class i{constructor(e){this.config=e,this.performanceImages=[],this.errorCode=\"\",this.scriptTimer=new Date,this.infiniteLoopId=null}init(){if(this._isValidPreconditions()){this.infiniteLoopId=setTimeout(()=>{this._handleInfiniteLoop()},1e4);try{var e=this._generateLcpCandidates(1/0);e&&(this._initWithFirstElementWithInfo(e),this._fillATFWithoutDuplications(e))}catch(e){this.errorCode=\"script_error\",this._logMessage(\"Script Error: \"+e)}this._saveFinalResultIntoDB()}else this._finalize()}_isValidPreconditions(){return this._isNotValidScreensize()?(this._logMessage(\"Bailing out because screen size is not acceptable\"),!1):!this._isGeneratedBefore()||(this._logMessage(\"Bailing out because data is already available\"),!1)}_isGeneratedBefore(){let e=new FormData;return e.append(\"action\",\"rocket_check_lcp\"),e.append(\"rocket_lcp_nonce\",this.config.nonce),e.append(\"url\",this.config.url),e.append(\"is_mobile\",this.config.is_mobile),fetch(this.config.ajax_url,{method:\"POST\",credentials:\"same-origin\",body:e}).success}_isNotValidScreensize(){var e=this._getCurrentScrrenWidth(),t=this._getCurrentScrrenHeight(),r=this.config.is_mobile&&(e>this.config.width_threshold||t>this.config.height_threshold),t=!this.config.is_mobile&&(e<this.config.width_threshold||t<this.config.height_threshold);return r||t}_getCurrentScrrenWidth(){return window.screen.width}_getCurrentScrrenHeight(){return window.screen.height}_generateLcpCandidates(e){var t=document.querySelectorAll(this.config.elements);if(t.length<=0)return[];const r=Array.from(t),i=r.map(e=>{var t=e.getBoundingClientRect();return{element:e,rect:t}}).filter(e=>0<e.rect.width&&0<e.rect.height&&this._isIntersecting(e.rect)).map(e=>({item:e,area:this._getElementArea(e.rect),elementInfo:this._getElementInfo(e.element)})).sort((e,t)=>t.area-e.area).slice(0,e);return i.map(e=>({element:e.item.element,elementInfo:e.elementInfo}))}_isIntersecting(e){return 0<=e.bottom&&0<=e.right&&e.top<=this._getCurrentScrrenHeight()&&e.left<=this._getCurrentScrrenWidth()}_getElementArea(e){return Math.min(e.width,this._getCurrentScrrenWidth()-e.left)*Math.min(e.height,this._getCurrentScrrenHeight()-e.top)}_getElementInfo(e){var t=e.nodeName.toLowerCase();const r={type:\"\",src:\"\",srcset:\"\",sizes:\"\",sources:[],bg_set:[],current_src:\"\"};if(\"img\"===t&&e.srcset)r.type=\"img-srcset\",r.src=e.src,r.srcset=e.srcset,r.sizes=e.sizes,r.current_src=e.currentSrc;else if(\"img\"===t)r.type=\"img\",r.src=e.src,r.current_src=e.currentSrc;else if(\"video\"===t){r.type=\"img\";var i=e.querySelector(\"source\");r.src=e.poster||(i?i.src:\"\"),r.current_src=r.src}else if(\"svg\"===t){const s=e.querySelector(\"image\");s&&(r.type=\"img\",r.src=s.getAttribute(\"href\")||\"\",r.current_src=r.src)}else if(\"picture\"===t)r.type=\"picture\",t=e.querySelector(\"img:not(picture>img)\"),r.src=t?t.src:\"\",r.sources=Array.from(e.querySelectorAll(\"source\")).map(e=>({srcset:e.srcset||\"\",media:e.media||\"\"}));else{const n=window.getComputedStyle(e,null),o=[n.getPropertyValue(\"background-image\"),getComputedStyle(e,\":after\").getPropertyValue(\"background-image\"),getComputedStyle(e,\":before\").getPropertyValue(\"background-image\")],c=o.filter(e=>\"none\"!==e).join(\"\");if(r.type=\"bg-img\",c.includes(\"image-set(\")&&(r.type=\"bg-img-set\"),!c||\"\"===c)return null;const a=[...c.matchAll(/url\\(\\s*?['\"]?\\s*?(\\S+?)\\s*?[\"']?\\s*?\\)\\s*?([a-zA-Z0-9\\s]*[x|dpcm|dpi|dppx]?)/gi)];r.bg_set=a.map(e=>e[1]?{src:e[1].trim()+(e[2]?\" \"+e[2].trim():\"\")}:{}),r.bg_set.every(e=>\"\"===e.src)&&(r.bg_set=a.map(e=>e[1]?{src:e[1].trim()}:{})),0<r.bg_set.length&&(r.src=r.bg_set[0].src,\"bg-img-set\"===r.type&&(r.src=r.bg_set))}return r}_initWithFirstElementWithInfo(e){if(!(e=e.find(e=>null!==e.elementInfo)))return this._logMessage(\"No LCP candidate found.\"),void(this.performanceImages=[]);this.performanceImages=[{...e.elementInfo,label:\"lcp\"}]}_fillATFWithoutDuplications(e){e.forEach(e=>{var{element:t,elementInfo:e}=e;this._isDuplicateImage(t)||this.performanceImages.push({...e,label:\"above-the-fold\"})})}_isDuplicateImage(e){const t=this._getElementInfo(e);if(null===t)return!1;var r=\"img\"===t.type||\"img-srcset\"===t.type||\"video\"===t.type,e=\"bg-img\"===t.type||\"bg-img-set\"===t.type||\"picture\"===t.type;return(r||e)&&this.performanceImages.some(e=>e.src===t.src)}_getFinalStatus(){return\"\"!==this.errorCode?this.errorCode:10<=(new Date-this.scriptTimer)/1e3?\"timeout\":\"success\"}_saveFinalResultIntoDB(){const e=new FormData;e.append(\"action\",\"rocket_lcp\"),e.append(\"rocket_lcp_nonce\",this.config.nonce),e.append(\"url\",this.config.url),e.append(\"is_mobile\",this.config.is_mobile),e.append(\"images\",JSON.stringify(this.performanceImages)),e.append(\"status\",this._getFinalStatus()),fetch(this.config.ajax_url,{method:\"POST\",credentials:\"same-origin\",body:e,headers:{\"wpr-saas-no-intercept\":!0}}).then(e=>e.json()).then(e=>{this._logMessage(e)}).catch(e=>{this._logMessage(e)}).finally(()=>{this._finalize()})}_handleInfiniteLoop(){this._saveFinalResultIntoDB()}_finalize(){const e=document.querySelector('[data-name=\"wpr-lcp-beacon\"]');e.setAttribute(\"beacon-completed\",\"true\"),clearTimeout(this.infiniteLoopId)}_logMessage(e){this.config.debug&&console.log(e)}static run(){if(window.rocket_lcp_data){const e=new i(window.rocket_lcp_data);\"loading\"===document.readyState?document.addEventListener(\"DOMContentLoaded\",()=>{setTimeout(()=>{e.init()},500)}):setTimeout(()=>{e.init()},500)}}}).run()},{}]},{},[1]);"],"file":"lcp-beacon.js"}